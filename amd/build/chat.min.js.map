{"version":3,"file":"chat.min.js","sources":["../src/chat.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Full page chat functionality for Teacher Assistant.\n *\n * @module     local_teacherassistant/chat\n * @copyright  2025 Your Name\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Templates from 'core/templates';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\nclass ChatManager {\n    constructor(courseId) {\n        this.courseId = courseId;\n    }\n\n    /**\n     * Initialize the full page chat.\n     */\n    async init() {\n        await this.render();\n        this.attachEventHandlers();\n    }\n\n    /**\n     * Render the chat interface.\n     */\n    async render() {\n        console.log('Rendering chat interface...');\n        try {\n            const context = {\n                courseid: this.courseId\n            };\n\n            const html = await Templates.render('local_teacherassistant/chat_fullpage', context);\n            const container = document.getElementById('teacherassistant-chat-container');\n            if (container) {\n                container.innerHTML = html;\n            }\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Attach event handlers.\n     */\n    attachEventHandlers() {\n        const sendBtn = document.getElementById('teacherassistant-fullpage-send-btn');\n        const input = document.getElementById('teacherassistant-fullpage-input');\n\n        if (sendBtn) {\n            sendBtn.addEventListener('click', () => this.sendMessage());\n        }\n\n        if (input) {\n            input.addEventListener('keydown', (e) => {\n                if (e.key === 'Enter' && !e.ctrlKey && !e.shiftKey) {\n                    e.preventDefault();\n                    this.sendMessage();\n                }\n            });\n        }\n    }\n\n    /**\n     * Send a message.\n     */\n    async sendMessage() {\n        const input = document.getElementById('teacherassistant-fullpage-input');\n        const message = input?.value.trim();\n\n        if (!message) {\n            return;\n        }\n\n        // Add user message to chat\n        this.addMessage(message, 'user');\n\n        // Clear input\n        input.value = '';\n\n        // Show loading indicator\n        this.showLoading();\n\n        try {\n            // Make AJAX call to backend\n            const response = await Ajax.call([{\n                methodname: 'local_teacherassistant_send_message',\n                args: {\n                    courseid: this.courseId,\n                    message: message\n                }\n            }])[0];\n\n            this.hideLoading();\n            this.addMessage(response.message, 'assistant');\n        } catch (error) {\n            this.hideLoading();\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Add a message to the chat.\n     *\n     * @param {string} text - The message text\n     * @param {string} sender - 'user' or 'assistant'\n     */\n    addMessage(text, sender) {\n        const messagesContainer = document.getElementById('teacherassistant-fullpage-messages');\n        if (!messagesContainer) {\n            return;\n        }\n\n        const messageDiv = document.createElement('div');\n        messageDiv.className = `teacherassistant-fullpage-message teacherassistant-fullpage-message-${sender}`;\n\n        const contentDiv = document.createElement('div');\n        contentDiv.className = 'teacherassistant-fullpage-message-content';\n        contentDiv.textContent = text;\n\n        messageDiv.appendChild(contentDiv);\n        messagesContainer.appendChild(messageDiv);\n        messagesContainer.scrollTop = messagesContainer.scrollHeight;\n    }\n\n    /**\n     * Show loading indicator.\n     */\n    showLoading() {\n        const messagesContainer = document.getElementById('teacherassistant-fullpage-messages');\n        if (!messagesContainer) {\n            return;\n        }\n\n        const loadingDiv = document.createElement('div');\n        loadingDiv.id = 'teacherassistant-fullpage-loading';\n        loadingDiv.className = 'teacherassistant-fullpage-message teacherassistant-fullpage-message-assistant';\n\n        const contentDiv = document.createElement('div');\n        contentDiv.className = 'teacherassistant-fullpage-message-content';\n        contentDiv.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Thinking...';\n\n        loadingDiv.appendChild(contentDiv);\n        messagesContainer.appendChild(loadingDiv);\n        messagesContainer.scrollTop = messagesContainer.scrollHeight;\n    }\n\n    /**\n     * Hide loading indicator.\n     */\n    hideLoading() {\n        const loading = document.getElementById('teacherassistant-fullpage-loading');\n        if (loading) {\n            loading.remove();\n        }\n    }\n}\n\nexport const init = (courseId) => {\n    console.log('Initializing Teacher Assistant full page chat...');\n    console.log(`Course ID: ${courseId}`);\n    const manager = new ChatManager(courseId);\n    console.log('ChatManager instance created.');\n    console.log(manager);\n    manager.init();\n};\n"],"names":["_interopRequireDefault","e","__esModule","default","_templates","_ajax","_notification","ChatManager","constructor","courseId","this","init","render","attachEventHandlers","console","log","context","courseid","html","Templates","container","document","getElementById","innerHTML","error","Notification","exception","sendBtn","input","addEventListener","sendMessage","key","ctrlKey","shiftKey","preventDefault","message","value","trim","addMessage","showLoading","response","Ajax","call","methodname","args","hideLoading","text","sender","messagesContainer","messageDiv","createElement","className","contentDiv","textContent","appendChild","scrollTop","scrollHeight","loadingDiv","id","loading","remove","_exports","manager"],"mappings":"oJAyB6C,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA;;;;;;;kFAF7CG,WAAAJ,uBAAAI,YACAC,MAAAL,uBAAAK,OACAC,cAAAN,uBAAAM,eAEA,MAAMC,YACFC,WAAAA,CAAYC,UACRC,KAAKD,SAAWA,QACpB,CAKA,UAAME,SACID,KAAKE,SACXF,KAAKG,qBACT,CAKA,YAAMD,GACFE,QAAQC,IAAI,+BACZ,IACI,MAAMC,QAAU,CACZC,SAAUP,KAAKD,UAGbS,WAAaC,WAAShB,QAACS,OAAO,uCAAwCI,SACtEI,UAAYC,SAASC,eAAe,mCACtCF,YACAA,UAAUG,UAAYL,KAE7B,CAAC,MAAOM,OACLC,cAAAA,QAAaC,UAAUF,MAC3B,CACJ,CAKAX,mBAAAA,GACI,MAAMc,QAAUN,SAASC,eAAe,sCAClCM,MAAQP,SAASC,eAAe,mCAElCK,SACAA,QAAQE,iBAAiB,QAAS,IAAMnB,KAAKoB,eAG7CF,OACAA,MAAMC,iBAAiB,UAAY5B,IACjB,UAAVA,EAAE8B,KAAoB9B,EAAE+B,SAAY/B,EAAEgC,WACtChC,EAAEiC,iBACFxB,KAAKoB,gBAIrB,CAKA,iBAAMA,GACF,MAAMF,MAAQP,SAASC,eAAe,mCAChCa,QAAUP,iBAAK,EAALA,MAAOQ,MAAMC,OAE7B,GAAKF,QAAL,CAKAzB,KAAK4B,WAAWH,QAAS,QAGzBP,MAAMQ,MAAQ,GAGd1B,KAAK6B,cAEL,IAEI,MAAMC,eAAiBC,cAAKC,KAAK,CAAC,CAC9BC,WAAY,sCACZC,KAAM,CACF3B,SAAUP,KAAKD,SACf0B,QAASA,YAEb,GAEJzB,KAAKmC,cACLnC,KAAK4B,WAAWE,SAASL,QAAS,YACrC,CAAC,MAAOX,OACLd,KAAKmC,cACLpB,cAAAA,QAAaC,UAAUF,MAC3B,CA1BA,CA2BJ,CAQAc,UAAAA,CAAWQ,KAAMC,QACb,MAAMC,kBAAoB3B,SAASC,eAAe,sCAClD,IAAK0B,kBACD,OAGJ,MAAMC,WAAa5B,SAAS6B,cAAc,OAC1CD,WAAWE,UAAY,uEAAuEJ,SAE9F,MAAMK,WAAa/B,SAAS6B,cAAc,OAC1CE,WAAWD,UAAY,4CACvBC,WAAWC,YAAcP,KAEzBG,WAAWK,YAAYF,YACvBJ,kBAAkBM,YAAYL,YAC9BD,kBAAkBO,UAAYP,kBAAkBQ,YACpD,CAKAjB,WAAAA,GACI,MAAMS,kBAAoB3B,SAASC,eAAe,sCAClD,IAAK0B,kBACD,OAGJ,MAAMS,WAAapC,SAAS6B,cAAc,OAC1CO,WAAWC,GAAK,oCAChBD,WAAWN,UAAY,gFAEvB,MAAMC,WAAa/B,SAAS6B,cAAc,OAC1CE,WAAWD,UAAY,4CACvBC,WAAW7B,UAAY,oDAEvBkC,WAAWH,YAAYF,YACvBJ,kBAAkBM,YAAYG,YAC9BT,kBAAkBO,UAAYP,kBAAkBQ,YACpD,CAKAX,WAAAA,GACI,MAAMc,QAAUtC,SAASC,eAAe,qCACpCqC,SACAA,QAAQC,QAEhB,EAUFC,SAAAlD,KAPmBF,WACjBK,QAAQC,IAAI,oDACZD,QAAQC,IAAI,cAAcN,YAC1B,MAAMqD,QAAU,IAAIvD,YAAYE,UAChCK,QAAQC,IAAI,iCACZD,QAAQC,IAAI+C,SACZA,QAAQnD,OACV"}