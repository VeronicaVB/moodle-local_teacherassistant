define("local_teacherassistant/popup",["exports","core/templates","core/ajax","core/notification"],function(_exports,_templates,_ajax,_notification){function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}
/**
   * Teacher Assistant popup functionality.
   *
   * @module     local_teacherassistant/popup
   * @copyright  2025 Your Name
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=_interopRequireDefault(_templates),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);class PopupManager{constructor(courseId){this.isMinimized=!0,this.courseId=courseId}async init(){await this.render(),this.attachEventHandlers()}async render(){console.log("Rendering Teacher Assistant popup");try{let container=document.getElementById("teacherassistant-container");container||(container=document.createElement("div"),container.id="teacherassistant-container",document.body.appendChild(container));const context={courseid:this.courseId};console.log("Rendering popup with context:",context);const html=await _templates.default.render("local_teacherassistant/popup",context);console.log(html),container&&(container.innerHTML=html)}catch(error){_notification.default.exception(error)}}attachEventHandlers(){const toggleBtn=document.getElementById("teacherassistant-toggle-btn"),minimizeBtn=document.getElementById("teacherassistant-minimize-btn"),expandBtn=document.getElementById("teacherassistant-expand-btn"),sendBtn=document.getElementById("teacherassistant-send-btn"),input=document.getElementById("teacherassistant-input");toggleBtn&&toggleBtn.addEventListener("click",()=>this.togglePopup()),minimizeBtn&&minimizeBtn.addEventListener("click",()=>this.minimizePopup()),expandBtn&&expandBtn.addEventListener("click",()=>this.expandToFullPage()),sendBtn&&sendBtn.addEventListener("click",()=>this.sendMessage()),input&&input.addEventListener("keydown",e=>{"Enter"!==e.key||e.ctrlKey||e.shiftKey||(e.preventDefault(),this.sendMessage())})}togglePopup(){const popup=document.getElementById("teacherassistant-popup"),content=document.getElementById("teacherassistant-content");popup&&content&&(this.isMinimized?(popup.classList.remove("teacherassistant-minimized"),popup.classList.add("teacherassistant-expanded"),content.style.display="flex",this.isMinimized=!1):this.minimizePopup())}minimizePopup(){const popup=document.getElementById("teacherassistant-popup"),content=document.getElementById("teacherassistant-content");popup&&content&&(content.style.display="none",popup.classList.remove("teacherassistant-expanded"),popup.classList.add("teacherassistant-minimized"),this.isMinimized=!0)}expandToFullPage(){if(this.courseId){const url=`${M.cfg.wwwroot}/local/teacherassistant/chat.php?courseid=${this.courseId}`;window.open(url,"_blank")}}async sendMessage(){const input=document.getElementById("teacherassistant-input"),message=null==input?void 0:input.value.trim();if(message){this.addMessage(message,"user"),input.value="",this.showLoading();try{const response=await _ajax.default.call([{methodname:"local_teacherassistant_send_message",args:{courseid:this.courseId,message:message}}])[0];this.hideLoading(),this.addMessage(response.message,"assistant")}catch(error){this.hideLoading(),_notification.default.exception(error)}}}addMessage(text,sender){const messagesContainer=document.getElementById("teacherassistant-messages");if(!messagesContainer)return;const messageDiv=document.createElement("div");messageDiv.className=`teacherassistant-message teacherassistant-message-${sender}`;const contentDiv=document.createElement("div");contentDiv.className="teacherassistant-message-content",contentDiv.textContent=text,messageDiv.appendChild(contentDiv),messagesContainer.appendChild(messageDiv),messagesContainer.scrollTop=messagesContainer.scrollHeight}showLoading(){const messagesContainer=document.getElementById("teacherassistant-messages");if(!messagesContainer)return;const loadingDiv=document.createElement("div");loadingDiv.id="teacherassistant-loading",loadingDiv.className="teacherassistant-message teacherassistant-message-assistant";const contentDiv=document.createElement("div");contentDiv.className="teacherassistant-message-content",contentDiv.innerHTML='<i class="fa fa-spinner fa-spin"></i> Thinking...',loadingDiv.appendChild(contentDiv),messagesContainer.appendChild(loadingDiv),messagesContainer.scrollTop=messagesContainer.scrollHeight}hideLoading(){const loading=document.getElementById("teacherassistant-loading");loading&&loading.remove()}}_exports.init=courseId=>{console.log("Teacher Assistant popup initialized");new PopupManager(courseId).init()}});

//# sourceMappingURL=popup.min.js.map